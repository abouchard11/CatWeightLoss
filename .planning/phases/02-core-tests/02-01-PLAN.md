---
phase: 02-core-tests
plan: 01
type: execute
---

<objective>
Add comprehensive unit tests for PortionCalculator.

Purpose: Ensure health-critical calorie calculations are correct.
Output: PortionCalculatorTests.swift with tests for RER, MER, weightLossCalories, validateTargetWeight.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@CatWeightLoss/Services/PortionCalculator.swift
@CatWeightLossTests/CatWeightLossTests.swift

**Current state:** Test target exists with placeholder test
**Focus:** PortionCalculator static functions (pure functions, easy to test)
**Formula reference:** RER = 70 × (weight in kg)^0.75
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PortionCalculatorTests.swift</name>
  <files>CatWeightLossTests/PortionCalculatorTests.swift</files>
  <action>
Create comprehensive test file with:

1. **RER Tests** (restingEnergyRequirement)
   - Test 4kg cat → RER ≈ 198.1 kcal
   - Test 5kg cat → RER ≈ 234.1 kcal
   - Test edge case: 0.5kg kitten
   - Test edge case: 10kg large cat

2. **MER Tests** (maintenanceEnergyRequirement)
   - Test indoor cat (1.2× factor)
   - Test active cat (1.4× factor)
   - Verify MER = RER × factor

3. **weightLossCalories Tests**
   - Test 15% reduction applied correctly
   - Test calories never go below RER
   - Test edge case: target < current

4. **validateTargetWeight Tests**
   - Test valid 10% loss → true
   - Test valid 20% loss → true
   - Test invalid 35% loss → false
   - Test invalid target > current → false
   - Test invalid target ≤ 0 → false

Use XCTAssertEqual with accuracy for floating point.
  </action>
  <verify>xcodebuild -project CatWeightLoss.xcodeproj -scheme CatWeightLossTests -destination 'platform=iOS Simulator,name=iPhone 17' test</verify>
  <done>All PortionCalculator tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PortionCalculatorTests.swift exists
- [ ] All tests pass (xcodebuild test succeeds)
- [ ] Coverage includes RER, MER, weightLossCalories, validateTargetWeight
- [ ] Edge cases tested
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Health-critical calculations have test coverage
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-tests/02-01-SUMMARY.md`
</output>
